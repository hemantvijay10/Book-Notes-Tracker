<!--
  Book Notes Tracker - Book Detail Page
  Author: Hemant Vijay
  Last Updated: 3-Nov-2025
  Project Credit: This project is part of Angela Yu's Complete Web Development Bootcamp
  Course URL: https://www.udemy.com/course/the-complete-web-development-bootcamp/learn/lecture/40325688#overview

  This page displays the full details of a single book
  Shows the cover, all information, and complete notes
-->

<!-- Include the header partial -->
<%- include('partials/header') %>

<div class="container">
  <!-- Back button to return to the list -->
  <div class="back-link">
    <a href="/">&larr; Back to List</a>
  </div>

  <!-- Book detail card -->
  <div class="book-detail">
    <div class="book-detail-grid">
      <!-- Left side: Book cover -->
      <div class="book-detail-cover">
        <img src="<%= book.coverUrl %>" alt="Cover of <%= book.title %>" onerror="this.src='/images/no-cover.svg'">
      </div>

      <!-- Right side: Book information -->
      <div class="book-detail-info">
        <!-- Book title -->
        <h1 class="book-detail-title"><%= book.title %></h1>

        <!-- Book author -->
        <p class="book-detail-author">by <%= book.author %></p>

        <!-- Display rating if available -->
        <% if (book.rating) { %>
          <div class="book-detail-rating">
            <span class="stars">
              <% for (let i = 0; i < book.rating; i++) { %>
                &#9733;
              <% } %>
            </span>
            <span class="rating-number"><%= book.rating %>/10</span>
          </div>
        <% } %>

        <!-- Display metadata in a table format -->
        <div class="book-metadata">
          <!-- Display ISBN if available -->
          <% if (book.isbn) { %>
            <div class="metadata-row">
              <span class="metadata-label">ISBN:</span>
              <span class="metadata-value"><%= book.isbn %></span>
            </div>
          <% } %>

          <!-- Display date read if available -->
          <% if (book.date_read) { %>
            <div class="metadata-row">
              <span class="metadata-label">Date Read:</span>
              <span class="metadata-value">
                <%= new Date(book.date_read).toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                }) %>
              </span>
            </div>
          <% } %>

          <!-- Display when the entry was added -->
          <div class="metadata-row">
            <span class="metadata-label">Added:</span>
            <span class="metadata-value">
              <%= new Date(book.created_at).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              }) %>
            </span>
          </div>

          <!-- Display when the entry was last updated (if different from created) -->
          <% if (book.updated_at && new Date(book.updated_at).getTime() !== new Date(book.created_at).getTime()) { %>
            <div class="metadata-row">
              <span class="metadata-label">Last Updated:</span>
              <span class="metadata-value">
                <%= new Date(book.updated_at).toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                }) %>
              </span>
            </div>
          <% } %>
        </div>

        <!-- Action buttons -->
        <div class="book-detail-actions">
          <a href="/edit/<%= book.id %>" class="btn-primary">Edit Book</a>
          <form action="/delete/<%= book.id %>" method="POST" style="display: inline;">
            <button type="submit" class="btn-danger" onclick="return confirm('Are you sure you want to delete this book?')">
              Delete Book
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Notes section (full width below the grid) -->
    <% if (book.notes) { %>
      <div class="book-notes-section">
        <h2>My Notes</h2>
        <div class="book-notes-full">
          <!-- Display notes with line breaks preserved -->
          <%= book.notes.split('\n').join('\n') %>
        </div>
      </div>
    <% } %>
  </div>
</div>

<!-- Include the footer partial -->
<%- include('partials/footer') %>
